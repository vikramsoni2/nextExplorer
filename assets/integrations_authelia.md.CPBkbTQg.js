import{_ as i,c as a,o as e,ag as t}from"./chunks/framework.Clp4v-ho.js";const c=JSON.parse('{"title":"Authelia (OIDC) Setup","description":"","frontmatter":{},"headers":[],"relativePath":"integrations/authelia.md","filePath":"integrations/authelia.md"}'),n={name:"integrations/authelia.md"};function l(h,s,p,r,o,d){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="authelia-oidc-setup" tabindex="-1">Authelia (OIDC) Setup <a class="header-anchor" href="#authelia-oidc-setup" aria-label="Permalink to &quot;Authelia (OIDC) Setup&quot;">​</a></h1><p>Authelia can act as the OIDC Identity Provider for nextExplorer using the Authorization Code flow. This guide shows how to stand up Authelia and connect it via environment variables.</p><h2 id="authelia-prerequisites" tabindex="-1">Authelia prerequisites <a class="header-anchor" href="#authelia-prerequisites" aria-label="Permalink to &quot;Authelia prerequisites&quot;">​</a></h2><ul><li>Two hostnames (e.g., <code>auth.example.com</code> and <code>files.example.com</code>). Both should serve TLS.</li><li>Docker Compose (Authelia + Redis stack) or an existing Authelia deployment.</li><li>Secrets for JWT/session, storage encryption, and the Authelia OIDC issuer private key.</li></ul><h2 id="example-authelia-stack" tabindex="-1">Example Authelia stack <a class="header-anchor" href="#example-authelia-stack" aria-label="Permalink to &quot;Example Authelia stack&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  redis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">redis:7-alpine</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;redis-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--appendonly&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;yes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  authelia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">authelia/authelia:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">redis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./authelia/config:/config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;9091:9091&quot;</span></span></code></pre></div><p>Generate secrets (example commands):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -hex</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authelia/config/jwt_secret.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -hex</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authelia/config/session_secret.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -hex</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authelia/config/storage_encryption_key.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authelia/config/oidc_issuer_key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span></span></code></pre></div><p>Create <code>authelia/config/configuration.yml</code> with an OIDC provider client (see the existing sections for scopes, redirect URIs, and grant types). Include <code>groups</code> in the scopes so nextExplorer can map admins.</p><h2 id="nextexplorer-configuration" tabindex="-1">nextExplorer configuration <a class="header-anchor" href="#nextexplorer-configuration" aria-label="Permalink to &quot;nextExplorer configuration&quot;">​</a></h2><p>Add these variables to your nextExplorer service:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PUBLIC_URL=https://files.example.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SESSION_SECRET=please-change-me</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_ENABLED=true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_ISSUER=https://auth.example.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_CLIENT_ID=nextexplorer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_CLIENT_SECRET=CHANGE_ME_STRONG_SECRET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_SCOPES=openid profile email groups</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_ADMIN_GROUPS=next-admin admins</span></span></code></pre></div><p>The backend discovers <code>/login</code>, <code>/callback</code>, <code>/logout</code> automatically once OIDC is on. Admin elevation occurs when the user’s group claim intersects <code>OIDC_ADMIN_GROUPS</code>.</p><h2 id="testing-validation" tabindex="-1">Testing &amp; validation <a class="header-anchor" href="#testing-validation" aria-label="Permalink to &quot;Testing &amp; validation&quot;">​</a></h2><ul><li>Start Authelia and nextExplorer: <code>docker compose up -d authelia redis nextexplorer</code>.</li><li>Visit <code>https://files.example.com</code>, click “Continue with Single Sign-On,” authenticate via Authelia, and confirm you return to the app.</li><li>If you belong to <code>next-admin</code> (or whatever groups you configured), the <code>admin</code> role is granted automatically.</li></ul><h2 id="troubleshooting-tips" tabindex="-1">Troubleshooting tips <a class="header-anchor" href="#troubleshooting-tips" aria-label="Permalink to &quot;Troubleshooting tips&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Symptom</th><th>Fix</th></tr></thead><tbody><tr><td>Redirect URI mismatch</td><td>Ensure Authelia’s <code>redirect_uris</code> entry equals <code>\${PUBLIC_URL}/callback</code> (or <code>OIDC_CALLBACK_URL</code> if overridden).</td></tr><tr><td>Users not admin</td><td>Include the group claim in Authelia (via <code>groups</code> scope/mapping) and add the group name to <code>OIDC_ADMIN_GROUPS</code>.</td></tr><tr><td>Session issue after restart</td><td>Set a fixed <code>SESSION_SECRET</code> so the Express session stays valid.</td></tr><tr><td>Behind proxy</td><td>Set <code>PUBLIC_URL</code>, configure <code>TRUST_PROXY</code>, and forward <code>X-Forwarded-*</code> headers from your proxy.</td></tr></tbody></table>`,17)])])}const E=i(n,[["render",l]]);export{c as __pageData,E as default};
