import{_ as o,c as t,o as r,ag as a}from"./chunks/framework.Clp4v-ho.js";const p=JSON.parse('{"title":"Reverse Proxy & Networking","description":"","frontmatter":{},"headers":[],"relativePath":"installation/reverse-proxy.md","filePath":"installation/reverse-proxy.md"}'),d={name:"installation/reverse-proxy.md"};function i(s,e,c,n,l,h){return r(),t("div",null,[...e[0]||(e[0]=[a('<h1 id="reverse-proxy-networking" tabindex="-1">Reverse Proxy &amp; Networking <a class="header-anchor" href="#reverse-proxy-networking" aria-label="Permalink to &quot;Reverse Proxy &amp; Networking&quot;">​</a></h1><p>When exposing nextExplorer on a custom domain, a reverse proxy keeps the UI secure behind TLS while forwarding requests to the container. Use this guide to align <code>PUBLIC_URL</code>, trusted proxies, and CORS behavior.</p><h2 id="key-environment-variables" tabindex="-1">Key environment variables <a class="header-anchor" href="#key-environment-variables" aria-label="Permalink to &quot;Key environment variables&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Variable</th><th>Purpose</th></tr></thead><tbody><tr><td><code>PUBLIC_URL</code></td><td>External URL (no trailing slash) used to set cookies, determine OIDC callbacks, and drive CORS defaults. Example: <code>https://files.example.com</code>.</td></tr><tr><td><code>TRUST_PROXY</code></td><td>Controls Express’s trust level; accepts <code>false</code>, a number (hops), or lists such as <code>loopback,uniquelocal</code>. If unset and <code>PUBLIC_URL</code> exists, defaults to <code>loopback,uniquelocal</code>. (<code>backend/config/trustProxy.js</code> documents this mapping.)</td></tr><tr><td><code>CORS_ORIGIN(S)</code> / <code>ALLOWED_ORIGINS</code></td><td>Explicit CORS origins when they differ from <code>PUBLIC_URL</code>. Defaults to the origin of <code>PUBLIC_URL</code> when provided.</td></tr></tbody></table><h2 id="sample-nginx-proxy-manager-block" tabindex="-1">Sample Nginx Proxy Manager block <a class="header-anchor" href="#sample-nginx-proxy-manager-block" aria-label="Permalink to &quot;Sample Nginx Proxy Manager block&quot;">​</a></h2><ul><li>Point <code>files.example.com</code> to the container’s internal <code>3000</code> port.</li><li>Enable WebSockets and preserve <code>X-Forwarded-*</code> headers (usually automatic).</li><li>Terminate TLS at the proxy; nextExplorer marks cookies as <code>Secure</code> whenever <code>PUBLIC_URL</code> uses <code>https</code>.</li></ul><h2 id="trusted-proxy-notes" tabindex="-1">Trusted Proxy notes <a class="header-anchor" href="#trusted-proxy-notes" aria-label="Permalink to &quot;Trusted Proxy notes&quot;">​</a></h2><ul><li>Default when <code>PUBLIC_URL</code> is set: <code>loopback,uniquelocal</code>, which trusts local or private Docker networks without opening up to the public internet.</li><li>Override with values such as <code>1</code> (trust one hop) or CIDRs (<code>10.0.0.0/8,172.16.0.0/12</code>).</li><li>Avoid <code>TRUST_PROXY=true</code> alone; the entrypoint maps it to <code>loopback,uniquelocal</code> for safety.</li></ul><h2 id="cors-headers" tabindex="-1">CORS &amp; headers <a class="header-anchor" href="#cors-headers" aria-label="Permalink to &quot;CORS &amp; headers&quot;">​</a></h2><ul><li>Set <code>CORS_ORIGINS</code>/<code>ALLOWED_ORIGINS</code> when the app is accessed from multiple domains.</li><li>Ensure the proxy forwards <code>X-Forwarded-Proto</code>, <code>X-Forwarded-Host</code>, and <code>X-Forwarded-For</code> so the backend derives the correct <code>PUBLIC_URL</code> origin and TLS state.</li></ul><h2 id="networking-health-checklist" tabindex="-1">Networking health checklist <a class="header-anchor" href="#networking-health-checklist" aria-label="Permalink to &quot;Networking health checklist&quot;">​</a></h2><ul><li>Proxy has TLS termination and forwards headers. Without headers, session cookies may appear as <code>Insecure</code>.</li><li>POST, PUT, DELETE operations work through the proxy; test with uploads and metadata edits.</li><li>If using OIDC, verify the IdP’s redirect URI matches <code>${PUBLIC_URL}/callback</code> or your manually supplied <code>OIDC_CALLBACK_URL</code>.</li></ul><h2 id="troubleshooting-proxies" tabindex="-1">Troubleshooting proxies <a class="header-anchor" href="#troubleshooting-proxies" aria-label="Permalink to &quot;Troubleshooting proxies&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Symptom</th><th>Fix</th></tr></thead><tbody><tr><td>CORS errors</td><td>Add the proxy domain to <code>CORS_ORIGINS</code> or set <code>PUBLIC_URL</code>.</td></tr><tr><td>Sessions drop</td><td>Confirm <code>TRUST_PROXY</code> lets Express read <code>X-Forwarded-Proto</code> and <code>COOKIE</code> is not stripped.</td></tr><tr><td>Redirect URI mismatch (OIDC)</td><td>Ensure the IdP redirect equals <code>${PUBLIC_URL}/callback</code> or the configured <code>OIDC_CALLBACK_URL</code>.</td></tr></tbody></table>',14)])])}const m=o(d,[["render",i]]);export{p as __pageData,m as default};
