import{_ as s,c as e,o as a,ae as n}from"./chunks/framework.BefrkHQ3.js";const k=JSON.parse('{"title":"OIDC (OpenID Connect)","description":"","frontmatter":{},"headers":[],"relativePath":"oidc.md","filePath":"oidc.md"}'),l={name:"oidc.md"};function t(p,i,o,d,h,c){return a(),e("div",null,[...i[0]||(i[0]=[n(`<h1 id="oidc-openid-connect" tabindex="-1">OIDC (OpenID Connect) <a class="header-anchor" href="#oidc-openid-connect" aria-label="Permalink to &quot;OIDC (OpenID Connect)&quot;">​</a></h1><p>nextExplorer supports OIDC via Express OpenID Connect (EOC) and works with providers like Keycloak, Authentik, and Authelia.</p><p>Endpoints</p><ul><li><code>/login</code> – Start login; accepts <code>?returnTo=/path</code> to redirect after auth</li><li><code>/callback</code> – Default OIDC callback path</li><li><code>/logout</code> – End session and (optionally) IdP logout</li></ul><p>Environment</p><ul><li><code>OIDC_ENABLED</code> – <code>true|false</code></li><li><code>OIDC_ISSUER</code> – Provider issuer URL (discovery)</li><li><code>OIDC_CLIENT_ID</code>, <code>OIDC_CLIENT_SECRET</code> – Client credentials</li><li><code>OIDC_SCOPES</code> – Default <code>openid profile email</code>; add <code>groups</code></li><li><code>OIDC_ADMIN_GROUPS</code> – Group names that grant <code>admin</code></li><li>If <code>OIDC_CALLBACK_URL</code> is not set, the app derives <code>\${PUBLIC_URL}/callback</code> when <code>PUBLIC_URL</code> is provided</li></ul><p>Admin mapping</p><ul><li>The app inspects <code>groups</code>, <code>roles</code>, and <code>entitlements</code> claims</li><li>If any match an entry in <code>OIDC_ADMIN_GROUPS</code> (case‑insensitive), the user is <code>admin</code>; otherwise <code>user</code></li></ul><p>Keycloak (confidential client)</p><ol><li>Clients → Create → <code>Client ID: nextexplorer</code>, Protocol: <code>openid-connect</code></li><li>Settings: Access Type <code>confidential</code>; Valid Redirect URIs: <code>https://files.example.com/callback</code></li><li>Credentials: copy Client Secret</li><li>Mappers: Add “Group Membership” mapper → Token Claim Name <code>groups</code> → Full group path OFF</li><li>Set env: <code>OIDC_ENABLED=true</code>, <code>OIDC_ISSUER=https://id.example.com/realms/main</code>, <code>OIDC_CLIENT_ID</code>, <code>OIDC_CLIENT_SECRET</code>, <code>OIDC_SCOPES=&quot;openid profile email groups&quot;</code>, <code>OIDC_ADMIN_GROUPS=&quot;next-admin admins&quot;</code></li></ol><p>Authentik</p><ol><li>Providers → OAuth2/OpenID → Create: <ul><li>Authorization flow: <code>authorization_code</code></li><li>Redirect URIs: <code>https://files.example.com/callback</code></li><li>Enable “Include claims in id_token” (optional but convenient)</li></ul></li><li>Applications → Create → Attach the provider; Confidential app</li><li>Claims/Scopes: Ensure <code>profile</code>, <code>email</code> are included; add a mapping for group membership to the <code>groups</code> claim (e.g., <code>member_of</code>)</li><li>Set env: <code>OIDC_ENABLED=true</code>, <code>OIDC_ISSUER=https://auth.example.com/application/o/next/</code>, client id/secret, scopes include <code>groups</code>, and <code>OIDC_ADMIN_GROUPS</code></li></ol><p>Authelia</p><ol><li>In <code>configuration.yml</code> enable the OIDC provider and define a client:<div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">identity_providers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  oidc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # issuer_private_key: |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #   -----BEGIN RSA PRIVATE KEY-----</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #   ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #   -----END RSA PRIVATE KEY-----</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    clients</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">client_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;nextexplorer&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        client_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;nextExplorer&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        client_secret</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;your-client-secret&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        authorization_policy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;one_factor&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        redirect_uris</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://files.example.com/callback&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        scopes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;openid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;profile&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;email&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;groups&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        grant_types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;authorization_code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        response_types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div></li><li>Set env: <code>OIDC_ISSUER=https://auth.example.com</code>, plus client id/secret and scopes</li></ol><p>Compose example</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nextexplorer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nxzai/explorer:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PUBLIC_URL=https://files.example.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_ENABLED=true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_ISSUER=https://auth.example.com/application/o/next/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_CLIENT_ID=nextexplorer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_CLIENT_SECRET=your-client-secret</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_SCOPES=openid profile email groups</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OIDC_ADMIN_GROUPS=next-admin admins</span></span></code></pre></div><p>Troubleshooting</p><ul><li>invalid redirect_uri – Ensure the redirect URI in your IdP is <code>\${PUBLIC_URL}/callback</code></li><li>“Not authorized” after login – Ensure a stable session secret. The app auto‑generates one at startup; set <code>SESSION_SECRET</code> explicitly to keep it stable across restarts or to share the same secret across replicas. Also confirm cookies are allowed through your proxy.</li><li>No admin privileges – Confirm your IdP sends <code>groups</code> (or <code>roles</code>/<code>entitlements</code>) and that <code>OIDC_ADMIN_GROUPS</code> matches</li><li>Callback mismatch behind proxy – Set <code>PUBLIC_URL</code> to your external URL and confirm proxy forwards <code>X‑Forwarded‑*</code> headers</li></ul>`,18)])])}const E=s(l,[["render",t]]);export{k as __pageData,E as default};
